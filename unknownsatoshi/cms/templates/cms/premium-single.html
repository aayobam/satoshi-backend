{% extends 'base2.html' %}
{% load social_share %}
{% load static %}

<title>{% block title %}UnknownSatoshi | {{blog.title}}{% endblock title %}</title>
<meta name="description" content="{% block meta %} {{blog.meta_snippet|safe}} {% endblock meta %}">



{% block content %}    
<style>
	i{
		font-size: 22px;
	}
</style>
<div class="page-wrapper margin-extra single-wrapper">
    <section class="article-wrapper">
        <div class="post-details">
            <span class="iconic-span"><i class="ri-calendar-line"></i> {{blog.created_on|date}}</span>
			<span class="iconic-span"><i class="ri-user-line"></i> {{blog.author}}</span>
			<span class="iconic-span icon-bg-dark"><i class="ri-eye-line"></i>{{blog_views}} views</span>
        </div>
        <div class="blog-content_container">
            <img src="{{blog.featured_image.url}}" class="blog-banner" alt="demo image for blog post">

            <h1 class="post-title">{{blog.title|title}}</h1>
            <div class="post-content">
                <p>{{blog.post|safe}}</p>
            </div>
        </div>

        <aside class="reviews-section article-details">
			<ul>
				<li class="iconic-span icon-bg-dark like-btn">
					{% if msg %}
						<i id="ilike" class="ri-heart-fill"></i>
					{% else %}
						<i id="ilike" class="ri-heart-line"></i>
					{% endif %}

					<span id="num"
				class="action-number__like">{{blog.likes.count}}</span></li>
					
				<li class="iconic-span icon-bg-dark"><i class="ri-message-2-line"></i> <span
						class="action-number__comment">{{blog.comment_set.all.count}}</span></li>
				<li class="iconic-span icon-bg-dark"><i class="ri-share-line"></i></li>
				
			</ul>
			<!-- <div class="action" onclick="actionToggle()">
				<span class="iconic-span icon-bg-dark"><i class="ri-share-line"></i></span>
				<ul>
					<li><i class="ri-facebook-circle-fill"></i> share on Facebook</li>
					<li><i class="ri-twitter-fill"></i> share on Twitter</li>
					<li><i class="ri-instagram-line"></i> share on Instagram</li>
					<li><i class="ri-linkedin-fill"></i> share on LinkedIn</li>
					<li><i class="ri-link"></i>Copy sharing link</li>
				</ul>
			</div> -->
		</aside>
    </section>

    <section class="comment-section">
		<form action="{% url 'premium-blog-detail' slug=blog.slug %}" method="POST">
			{% csrf_token %}
			{% for field in form %}
			<div>
				<label for="comment">{{field.label}}</label>
				{{field}}
			</div>
			{% endfor %}
			<button class="btn" type="submit" name="submit-btn">Publish Comment</button>
		</form>

		<main class="comments-wrapper">
			<h4>Comments</h4>
			{% for comment in blog.comment_set.all %}
				
			<div class="comment-container">
				<div class="profile-container">
					<img src="{% static 'images/profile_image/5.png' %}" alt="profile-image"><span>{{comment.owner|title}}</span>
				</div>
				<p>{{comment.body}}</p>
			</div>
			{% empty %}
				<p>No comments on this blog yet</p>
			{% endfor %}
		</main>
	</section>

	<section class="blog-post__section">
		<main class="stories-section related-posts">
			<h2>Related Articles</h2>
			<div class="blog-post__container">
				<div class="blog-post__card">
					<a href="#">
						<img src="{% static 'images/img-1.jpg' %}" alt="demo image">
						<div class="text-container">
							<h5>The hidden mystery behind cryptocurrency</h5>
							<p>I'm going to hire professional help tomorrow. I can't handle this anymore. She fell
								over the coffee table and now there is blood in her catheter...</p>
						</div>
					</a>
				</div>

				<div class="blog-post__card">
					<a href="#">
						<img src="{% static 'images/img-6.jpg' %}" alt="demo image">
						<div class="text-container">
							<h5><a href="#">How to grow your crypto currency portfolio</a></h5>
							<p>I'm going to hire professional help tomorrow. I can't handle this anymore. She fell
								over the coffee table and now there is blood in her catheter...</p>
						</div>
					</a>
				</div>

				<div class="blog-post__card">
					<a href="#">
						<img src="{% static 'images/img-5.jpg' %}" alt="demo image">
						<div class="text-container">
							<h5><a href="#">The hidden mystery behind cryptocurrency</a></h5>
							<p>I'm going to hire professional help tomorrow. I can't handle this anymore. She fell
								over the coffee table and now there is blood in her catheter...</p>
						</div>
					</a>
				</div>

			</div>
		</main>
	</section>

    <section class="newsletter-section">
		<h2>Newsletter</h2>
		<p>Sign up for our weekly newsletter to get the latest news, special offers, market researchs, crypto analysis
			and more. We promise not to spam your mail</p>

		<form action="index.html" method="post">
			<input type="email" name="email" id="email" class="input-field" placeholder="Input your email address..."
				required>
			<a class="btn" role="button" href="#">Join Newsletter</a>
		</form>
	</section>


	<section class="join-community">
		<h2>Become part of a global community of elite crypto traders</h2>
		<p>Don't miss the life changing opportunity crypto has to offer. Get access to latest informations, crypto
			signals and Market analysis</p>
		<a class="btn" href="https://discord.gg/zFGTdZYsQ4">Join Community</a>
	</section>
</div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>
	function getCookie(name) {
		let cookieValue = null;
		if (document.cookie && document.cookie !== '') {
			const cookies = document.cookie.split(';');
			for (let i = 0; i < cookies.length; i++) {
				const cookie = cookies[i].trim();
				// Does this cookie string begin with the name we want?
				if (cookie.substring(0, name.length + 1) === (name + '=')) {
					cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
					break;
				}
			}
		}
		return cookieValue;
	}
	const csrftoken = getCookie('csrftoken');

	let btn = document.getElementById("ilike")
	let num_of_likes = document.getElementById("num")
	let blog_id = "{{blog.id}}"

	btn.addEventListener("click", likePost)

	function likePost(e){
		let url = "{% url 'like' %}"
		const data = {id:blog_id}
	
		fetch(url, {
		  method: 'POST',
		  headers: {"Content-Type": "application/json",
		  'X-CSRFToken': csrftoken
		},
		  body : JSON.stringify(data)
		})
		.then(res => res.json())
		.then(data => {
		  console.log(data)
	
		  if(data["check"] == 1){
			btn.classList.remove("ri-heart-line")
			btn.classList.add('ri-heart-fill')
		  }
	
		  else if(data["check"] == 0){
			btn.classList.add("ri-heart-line")
			btn.classList.remove('ri-heart-fill')
		  }
	
		  else{
			alert("you need to login")
		  }
	
		  num_of_likes.innerHTML = data["num_of_likes"]
	
	
	
		})
	
	
	  }
</script>
{% endblock content %}